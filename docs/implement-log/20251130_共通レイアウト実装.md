# フェーズ4: 共通レイアウト実装

## 概要

レスポンシブ対応の共通レイアウトを実装しました。デスクトップではサイドバーが常に表示され、モバイルではハンバーガーメニューからサイドバーを開閉できます。

## 実装内容

### 1. サイドバーコンポーネント ([src/components/layout/Sidebar.tsx](../../src/components/layout/Sidebar.tsx))

**主な機能:**
- ロゴエリア（Briefcaseアイコン + "MyKintai"）
- ナビゲーションメニュー
  - 打刻・ホーム (/)
  - 月次実績 (/history)
  - 設定 (/settings)
- ユーザープロファイル表示
  - アバター画像
  - ユーザー名とメールアドレス
- ログアウトボタン

**レスポンシブ対応:**
- デスクトップ（lg以上）: 常に表示（`lg:translate-x-0`）
- モバイル: 初期状態は非表示（`-translate-x-full`）
- モバイルでサイドバーを開くとオーバーレイを表示

**アクティブ状態のスタイリング:**
```tsx
active
  ? 'bg-blue-50 text-blue-700 font-medium'
  : 'text-gray-700 hover:bg-gray-50'
```

現在のページをハイライト表示し、ユーザーがどこにいるか分かりやすくしています。

### 2. ヘッダーコンポーネント ([src/components/layout/Header.tsx](../../src/components/layout/Header.tsx))

**主な機能:**
- ハンバーガーメニューボタン（モバイル用）
- アプリタイトル表示
- 通知アイコン（プレースホルダー）

**表示条件:**
- モバイルのみ表示（`lg:hidden`）
- デスクトップでは非表示

### 3. AppLayoutコンポーネント ([src/components/layout/AppLayout.tsx](../../src/components/layout/AppLayout.tsx))

サイドバーとヘッダーを統合するラッパーコンポーネント。

**状態管理:**
```tsx
const [sidebarOpen, setSidebarOpen] = useState(false)
```
モバイルでのサイドバーの開閉状態を管理。

**レイアウト構造:**
```tsx
<div className="min-h-screen bg-gray-50">
  <Sidebar isOpen={sidebarOpen} onClose={...} />
  <Header onMenuClick={...} />
  <main className="lg:pl-64">
    {/* コンテンツ */}
  </main>
</div>
```

デスクトップでは`lg:pl-64`でサイドバー分の左パディングを確保。

### 4. 認証済みレイアウト ([src/app/(authenticated)/layout.tsx](../../src/app/(authenticated)/layout.tsx))

Route Groups機能を使用して、認証が必要なページに共通レイアウトを適用。

```tsx
export default function AuthenticatedLayout({ children }) {
  return <AppLayout>{children}</AppLayout>
}
```

`(authenticated)`フォルダ内のすべてのページに自動的にレイアウトが適用されます。

### 5. ルートレイアウト更新 ([src/app/layout.tsx](../../src/app/layout.tsx))

**フォント設定:**
- Noto Sans JPフォントを追加
- CSS変数として定義（`--font-noto-sans-jp`）
- globals.cssで`font-family-sans`に適用

**メタデータ:**
```tsx
export const metadata: Metadata = {
  title: "MyKintai - 勤怠管理アプリ",
  description: "シンプルな勤怠管理アプリケーション",
}
```

### 6. プレースホルダーページ作成

実装済み:
- [src/app/(authenticated)/page.tsx](../../src/app/(authenticated)/page.tsx) - ダッシュボード
- [src/app/(authenticated)/history/page.tsx](../../src/app/(authenticated)/history/page.tsx) - 月次実績
- [src/app/(authenticated)/settings/page.tsx](../../src/app/(authenticated)/settings/page.tsx) - 設定

## Q&A

### Q1: Route Groups `(authenticated)` の役割は?

<details>
<summary>回答を見る</summary>

Route Groups（`(グループ名)`）は、URL構造に影響を与えずにルートを整理する機能です。

```
app/
  (authenticated)/
    layout.tsx       # このレイアウトが適用される
    page.tsx         # URL: /
    history/
      page.tsx       # URL: /history
    settings/
      page.tsx       # URL: /settings
  login/
    page.tsx         # URL: /login (レイアウトは適用されない)
```

`(authenticated)`フォルダはURLに含まれず、このフォルダ内のページだけに`layout.tsx`が適用されます。
</details>

### Q2: なぜサイドバーの状態管理を`AppLayout`で行う?

<details>
<summary>回答を見る</summary>

サイドバーとヘッダーの両方が状態を参照・変更する必要があるため、共通の親コンポーネントで管理します。

- `Header`: `onMenuClick`でサイドバーを開く
- `Sidebar`: `onClose`でサイドバーを閉じる

親コンポーネント（`AppLayout`）で状態を管理することで、Props Drillingを最小限に抑えています。
</details>

### Q3: `lg:pl-64`の意味は?

<details>
<summary>回答を見る</summary>

```tsx
<main className="lg:pl-64">
```

- `lg:`: Tailwindのlgブレークポイント（1024px）以上
- `pl-64`: padding-left: 16rem（256px）

デスクトップではサイドバーが固定表示（幅256px）されるため、メインコンテンツに左パディングを設定してサイドバーと重ならないようにしています。

モバイルではサイドバーがオーバーレイ表示なので、パディングは不要です。
</details>

### Q4: モバイルでサイドバーを閉じる方法は?

<details>
<summary>回答を見る</summary>

3つの方法があります:

1. **オーバーレイをクリック**
   ```tsx
   <div onClick={onClose} />
   ```

2. **メニュー項目をクリック**
   ```tsx
   <Link onClick={onClose}>
   ```

3. **ESCキー** - 現在は未実装（必要に応じて追加可能）

ユーザーがメニューを選択したら自動的に閉じることで、UXを向上させています。
</details>

### Q5: `usePathname`の役割は?

<details>
<summary>回答を見る</summary>

```tsx
const pathname = usePathname()

const isActive = (href: string) => {
  if (href === '/') {
    return pathname === '/'
  }
  return pathname.startsWith(href)
}
```

現在のパスを取得して、アクティブなメニュー項目をハイライトします。

- ホーム（`/`）: 完全一致でチェック
- その他: 前方一致でチェック（例: `/history`は`/history/2024`でもアクティブ）

これにより、ユーザーが現在どのページにいるか視覚的に分かります。
</details>

### Q6: フォント設定でCSS変数を使う理由は?

<details>
<summary>回答を見る</summary>

Next.jsのフォント最適化とTailwind CSSを統合するため。

**layout.tsx:**
```tsx
const notoSansJP = Noto_Sans_JP({
  variable: '--font-noto-sans-jp',  // CSS変数を定義
})
```

**globals.css:**
```css
--font-family-sans: var(--font-noto-sans-jp), system-ui, sans-serif;
```

**利点:**
1. Next.jsがフォントを自動最適化（self-hosting）
2. FOUTを防ぐ（Flash of Unstyled Text）
3. Tailwindの`font-sans`クラスで自動適用

</details>
