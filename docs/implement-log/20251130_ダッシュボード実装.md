# フェーズ5: ダッシュボード（打刻・ホーム）実装

## 概要

ダッシュボードページとUIコンポーネントを実装しました。打刻機能のUIは完成していますが、実際のデータ操作はフェーズ6で実装予定です。

## 実装内容

### 1. 共通UIコンポーネント

#### Buttonコンポーネント ([src/components/ui/Button.tsx](../../src/components/ui/Button.tsx))

**機能:**
- 5つのバリアント（primary, secondary, success, warning, danger）
- フルワイドオプション
- disabled状態のサポート
- フォーカスリングのアクセシビリティ対応

**使用例:**
```tsx
<Button variant="primary" fullWidth onClick={handleClick}>
  業務開始
</Button>
```

#### Badgeコンポーネント ([src/components/ui/Badge.tsx](../../src/components/ui/Badge.tsx))

**機能:**
- 4つのバリアント（default, success, warning, danger）
- ステータス表示に使用

**使用例:**
```tsx
<Badge variant="success">稼働中</Badge>
```

#### Modalコンポーネント ([src/components/ui/Modal.tsx](../../src/components/ui/Modal.tsx))

**機能:**
- オーバーレイ背景（クリックで閉じる）
- ヘッダーと閉じるボタン
- モーダル表示中はbodyのスクロールを無効化
- ESCキーでの閉じる機能（useEffectのクリーンアップで対応）

**状態管理:**
```tsx
useEffect(() => {
  if (isOpen) {
    document.body.style.overflow = 'hidden'
  } else {
    document.body.style.overflow = 'unset'
  }
  return () => {
    document.body.style.overflow = 'unset'
  }
}, [isOpen])
```

### 2. ダッシュボードコンポーネント

#### StatusCard ([src/components/dashboard/StatusCard.tsx](../../src/components/dashboard/StatusCard.tsx))

**機能:**
- リアルタイム時計表示（1秒ごとに更新）
- 日付・曜日表示
- 現在のステータス表示（稼働外/稼働中/休憩中）
- ステータスに応じた打刻ボタンの表示切替
  - 稼働外: 業務開始（Blue）
  - 稼働中: 休憩開始（Orange）、業務終了（Slate）
  - 休憩中: 休憩終了（Green）
- 手動打刻リンク

**ステータス管理:**
```tsx
const statusConfig = {
  offline: { label: '稼働外', variant: 'default', color: 'text-slate-600' },
  working: { label: '稼働中', variant: 'success', color: 'text-green-600' },
  break: { label: '休憩中', variant: 'warning', color: 'text-orange-600' },
}
```

**リアルタイム更新:**
```tsx
useEffect(() => {
  const timer = setInterval(() => {
    setCurrentTime(new Date())
  }, 1000)
  return () => clearInterval(timer)
}, [])
```

#### ManualEntryModal ([src/components/dashboard/ManualEntryModal.tsx](../../src/components/dashboard/ManualEntryModal.tsx))

**機能:**
- 日付選択（デフォルト: 今日）
- 時刻選択（デフォルト: 現在時刻）
- 打刻種別選択（業務開始/業務終了/休憩開始/休憩終了）
- 備考入力（任意）
- フォームバリデーション

**デフォルト値の設定:**
```tsx
const [date, setDate] = useState(() => {
  const today = new Date()
  return today.toISOString().split('T')[0]
})
const [time, setTime] = useState(() => {
  const now = new Date()
  return now.toTimeString().slice(0, 5)
})
```

#### SummaryCard ([src/components/dashboard/SummaryCard.tsx](../../src/components/dashboard/SummaryCard.tsx))

**機能:**
- 今月の総稼働時間表示
- 概算報酬額表示（時給 × 稼働時間）
- 通貨フォーマット（日本円）

**フォーマット処理:**
```tsx
const formatCurrency = (amount: number) => {
  return new Intl.NumberFormat('ja-JP', {
    style: 'currency',
    currency: 'JPY',
  }).format(amount)
}
```

#### RecentHistory ([src/components/dashboard/RecentHistory.tsx](../../src/components/dashboard/RecentHistory.tsx))

**機能:**
- 直近の稼働履歴をテーブル表示
- 日付、ステータス、開始時刻、終了時刻、休憩時間、実働時間を表示
- 「すべて見る」リンク（月次実績ページへ）
- レスポンシブテーブル（横スクロール対応）

### 3. ダッシュボードページ ([src/app/(authenticated)/page.tsx](../../src/app/(authenticated)/page.tsx))

**レイアウト構成:**
```tsx
<div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <div className="lg:col-span-1">
    <StatusCard />
  </div>
  <div className="lg:col-span-2">
    <SummaryCard />
  </div>
</div>
<RecentHistory />
```

- デスクトップ: ステータスカード（1/3）+ サマリーカード（2/3）
- モバイル: 縦積み

**TODO項目:**
```tsx
// TODO: 実際のデータはフェーズ6で実装
const currentStatus = 'offline' as const
const totalHours = 0
const estimatedEarnings = 0
const recentEntries: any[] = []
```

フェーズ6でSupabaseとの連携を実装予定。

## Q&A

### Q1: なぜStatusCardでリアルタイム時計を実装した?

<details>
<summary>回答を見る</summary>

打刻アプリでは正確な時刻を表示することが重要です。ユーザーが打刻する際に、現在時刻を確認できることで以下のメリットがあります:

1. 打刻のタイミングを正確に把握できる
2. 誤った時刻での打刻を防げる
3. UIの信頼性が向上する

`setInterval`で1秒ごとに更新することで、常に最新の時刻を表示します。
</details>

### Q2: Modalでbody.style.overflowを制御する理由は?

<details>
<summary>回答を見る</summary>

```tsx
useEffect(() => {
  if (isOpen) {
    document.body.style.overflow = 'hidden'
  } else {
    document.body.style.overflow = 'unset'
  }
  return () => {
    document.body.style.overflow = 'unset'
  }
}, [isOpen])
```

モーダル表示中に背景のスクロールを防ぐため。

- モーダルが開いている時: `overflow: hidden`でスクロール無効化
- モーダルが閉じた時: `overflow: unset`でスクロール復元
- クリーンアップ関数: コンポーネントアンマウント時にスクロールを確実に復元

これにより、モーダル使用時のUXが向上します。
</details>

### Q3: ManualEntryModalで初期値を関数で設定している理由は?

<details>
<summary>回答を見る</summary>

```tsx
const [date, setDate] = useState(() => {
  const today = new Date()
  return today.toISOString().split('T')[0]
})
```

Lazy initializationと呼ばれるパターンで、以下の理由があります:

1. **初回レンダリングのみ実行**: 関数は初回レンダリング時のみ実行され、再レンダリング時は実行されない
2. **パフォーマンス**: 計算コストが高い初期値の場合に有効
3. **正確性**: コンポーネントがマウントされた時点の時刻を取得

通常の`useState(new Date())`だと、再レンダリングごとに`new Date()`が実行されますが、使用されるのは初回の値のみです。関数を渡すことで、初回のみ実行されるよう最適化されます。
</details>

### Q4: StatusCardのステータスごとのボタン表示ロジックは?

<details>
<summary>回答を見る</summary>

```tsx
{currentStatus === 'offline' && (
  <Button variant="primary">業務開始</Button>
)}

{currentStatus === 'working' && (
  <>
    <Button variant="warning">休憩開始</Button>
    <Button variant="secondary">業務終了</Button>
  </>
)}

{currentStatus === 'break' && (
  <Button variant="success">休憩終了</Button>
)}
```

各ステータスで表示するボタンを切り替えることで、ユーザーが次に取るべきアクションを明確にしています:

- **稼働外**: 業務開始のみ
- **稼働中**: 休憩開始または業務終了を選択可能
- **休憩中**: 休憩終了のみ

これにより、誤操作を防ぎ、直感的な操作が可能になります。
</details>

### Q5: RecentHistoryでentriesが空の場合の表示は?

<details>
<summary>回答を見る</summary>

```tsx
{entries.length === 0 ? (
  <p className="text-gray-500 text-center py-8">稼働履歴がありません</p>
) : (
  <table>...</table>
)}
```

Empty State（空状態）の表示です。データがない場合にユーザーに明確なメッセージを表示することで:

1. エラーではないことを理解できる
2. 何もデータがないことを明確に伝える
3. UIが壊れていると誤解されない

UXの基本原則として、空状態は必ず適切に表示すべきです。
</details>

### Q6: Intl.NumberFormatを使う理由は?

<details>
<summary>回答を見る</summary>

```tsx
const formatCurrency = (amount: number) => {
  return new Intl.NumberFormat('ja-JP', {
    style: 'currency',
    currency: 'JPY',
  }).format(amount)
}
```

ブラウザ標準のIntl APIを使用することで:

1. **国際化対応**: ロケールに応じた表示が可能
2. **正確なフォーマット**: 通貨記号や桁区切りが自動
3. **ライブラリ不要**: 追加の依存関係が不要

例: `formatCurrency(123456)` → `¥123,456`

手動で文字列操作するよりも、標準APIを使う方が安全で保守性が高いです。
</details>
